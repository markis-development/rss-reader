version: '2'

services:
  parser:
    image: golang:1.8.0
    volumes:
      - ./parser:/go/src/app
    working_dir: /go/src/app
    command: bash -c "go get; go run app.go"
    ports:
      - 6578:6578
    env_file:
      - .env
    depends_on:
      - reader_api

  reader_api:
    image: microsoft/dotnet:latest
    volumes:
      - ./dotnet_api:/app
    working_dir: /app
    command: bash -c "dotnet rss_dotnet_api.dll"
    depends_on:
      - databaseServer
    ports:
      - 5000:5000


  databaseServer:
    image: mysql:8
    environment:
      TZ: Europe/Warsaw
      MYSQL_ROOT_PASSWORD: dbroot
      MYSQL_DATABASE: db
      MYSQL_USER: dbuser
      MYSQL_PASSWORD: dbuser
    expose:
      - 3306

  cron:
    image: microsoft/dotnet:1.0.0-preview2-sdk
    volumes:
      - ./cron:/app
    working_dir: /app
    command: bash -c "dotnet restore; dotnet run"
    links:
      - parser
    ports:
      - 5001:5001
